<!DOCTYPE html>
<html lang="en" class="dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Now Playing - SilvaStream</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Watch movies and TV shows in high quality on SilvaStream">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Video.js for advanced player -->
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles/root.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/playback.css">
    
    <!-- Preload -->
    <link rel="preload" href="scripts/playback.js" as="script">
</head>
<body>
    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Preparing your stream...</p>
            <div class="buffering-stats">
                <span>Connection: <span id="connectionSpeed">Checking...</span></span>
                <span>Buffer: <span id="bufferStatus">0%</span></span>
            </div>
        </div>
    </div>

    <!-- Player Container -->
    <div class="player-container" id="playerContainer">
        <!-- Video Player -->
        <div class="video-wrapper">
            <video id="videoPlayer"
                   class="video-js vjs-default-skin vjs-big-play-centered"
                   controls
                   preload="auto"
                   data-setup='{}'>
                <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a
                    web browser that <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                </p>
            </video>
            
            <!-- Custom Controls Overlay -->
            <div class="custom-controls-overlay" id="customControls">
                <!-- Top Bar -->
                <div class="player-top-bar">
                    <button class="player-back-btn" id="playerBackBtn">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="player-title" id="playerTitle">Loading...</div>
                    <div class="player-meta">
                        <span id="playerCurrentTime">00:00</span>
                        <span>/</span>
                        <span id="playerDuration">00:00</span>
                    </div>
                </div>
                
                <!-- Center Play Button -->
                <div class="center-play-btn" id="centerPlayBtn">
                    <i class="fas fa-play"></i>
                </div>
                
                <!-- Bottom Controls -->
                <div class="player-bottom-controls">
                    <!-- Progress Bar -->
                    <div class="progress-section">
                        <div class="progress-bar-container">
                            <input type="range" 
                                   class="progress-slider" 
                                   id="progressSlider"
                                   min="0" 
                                   max="100" 
                                   value="0">
                            <div class="progress-buffer" id="progressBuffer"></div>
                            <div class="progress-filled" id="progressFilled"></div>
                        </div>
                        <div class="progress-time">
                            <span id="currentTimeDisplay">00:00</span>
                            <span>/</span>
                            <span id="totalTimeDisplay">00:00</span>
                        </div>
                    </div>
                    
                    <!-- Control Buttons -->
                    <div class="control-buttons">
                        <div class="control-left">
                            <button class="control-btn" id="playPauseBtn">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="control-btn" id="rewindBtn">
                                <i class="fas fa-backward"></i>
                                <span class="btn-tooltip">Rewind 10s</span>
                            </button>
                            <button class="control-btn" id="forwardBtn">
                                <i class="fas fa-forward"></i>
                                <span class="btn-tooltip">Forward 10s</span>
                            </button>
                            <button class="control-btn" id="volumeBtn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <div class="volume-slider-container">
                                <input type="range" 
                                       class="volume-slider" 
                                       id="volumeSlider"
                                       min="0" 
                                       max="100" 
                                       value="100">
                            </div>
                        </div>
                        
                        <div class="control-right">
                            <button class="control-btn" id="qualityBtn">
                                <i class="fas fa-hd"></i>
                                <span class="btn-tooltip">Quality</span>
                            </button>
                            <button class="control-btn" id="subtitleBtn">
                                <i class="fas fa-closed-captioning"></i>
                                <span class="btn-tooltip">Subtitles</span>
                            </button>
                            <button class="control-btn" id="speedBtn">
                                <i class="fas fa-tachometer-alt"></i>
                                <span class="btn-tooltip">Playback Speed</span>
                            </button>
                            <button class="control-btn" id="pipBtn">
                                <i class="fas fa-picture-in-picture"></i>
                                <span class="btn-tooltip">Picture-in-Picture</span>
                            </button>
                            <button class="control-btn" id="fullscreenBtn">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Playback Info -->
                <div class="playback-info" id="playbackInfo">
                    <div class="info-item">
                        <i class="fas fa-wifi"></i>
                        <span>Connection: <strong id="connectionInfo">Excellent</strong></span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-server"></i>
                        <span>Server: <strong id="serverInfo">Auto (Best)</strong></span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-microchip"></i>
                        <span>Buffer: <strong id="bufferInfo">100%</strong></span>
                    </div>
                </div>
            </div>
            
            <!-- Error Overlay -->
            <div class="error-overlay" id="errorOverlay">
                <div class="error-content">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Playback Error</h3>
                    <p id="errorMessage">Unable to load video</p>
                    <div class="error-actions">
                        <button class="btn btn-primary" id="retryBtn">
                            <i class="fas fa-redo"></i> Retry
                        </button>
                        <button class="btn btn-outline" id="qualitySelectBtn">
                            <i class="fas fa-hd"></i> Change Quality
                        </button>
                        <button class="btn btn-outline" id="downloadBtn">
                            <i class="fas fa-download"></i> Download Instead
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Next Episode Countdown -->
            <div class="next-episode-overlay" id="nextEpisodeOverlay">
                <div class="countdown-content">
                    <h4>Next Episode Starting Soon</h4>
                    <div class="countdown-timer" id="countdownTimer">5</div>
                    <div class="countdown-actions">
                        <button class="btn btn-primary" id="playNextBtn">
                            <i class="fas fa-play"></i> Play Now
                        </button>
                        <button class="btn btn-outline" id="cancelNextBtn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Player Sidebar -->
        <div class="player-sidebar" id="playerSidebar">
            <!-- Sidebar Toggle -->
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-chevron-left"></i>
            </button>
            
            <!-- Content Info -->
            <div class="content-info">
                <div class="content-poster">
                    <img id="contentPoster" src="" alt="">
                </div>
                <div class="content-details">
                    <h3 id="contentTitle">Loading...</h3>
                    <div class="content-meta">
                        <span id="contentYear">2024</span>
                        <span>•</span>
                        <span id="contentRating">8.5/10</span>
                        <span>•</span>
                        <span id="contentType">Movie</span>
                    </div>
                    <p class="content-description" id="contentDescription">
                        Loading description...
                    </p>
                </div>
            </div>
            
            <!-- Episode List (for series) -->
            <div class="episode-list-section" id="episodeListSection">
                <div class="section-header">
                    <h4>Episodes</h4>
                    <div class="season-selector">
                        <select id="seasonSelect">
                            <option value="1">Season 1</option>
                        </select>
                    </div>
                </div>
                <div class="episode-scroll" id="episodeScroll">
                    <!-- Episodes loaded by JS -->
                </div>
            </div>
            
            <!-- Related Content -->
            <div class="related-section">
                <h4>Up Next</h4>
                <div class="related-list" id="relatedList">
                    <!-- Related content loaded by JS -->
                </div>
            </div>
            
            <!-- WhatsApp Promo -->
            <div class="sidebar-promo">
                <i class="fab fa-whatsapp"></i>
                <div class="promo-text">
                    <strong>Watch Parties</strong>
                    <small>Share & watch with friends</small>
                </div>
                <a href="https://whatsapp.com/channel/0029VaAgJ8PAe5ViH81LR41u" 
                   class="btn btn-sm btn-whatsapp" 
                   target="_blank">
                    Join
                </a>
            </div>
        </div>
    </div>
    
    <!-- Quality Selection Modal -->
    <div class="modal" id="qualityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Quality</h3>
                <button class="modal-close" id="closeQualityModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="quality-options" id="qualityOptions">
                    <!-- Quality options loaded by JS -->
                </div>
                <div class="auto-quality">
                    <label class="checkbox-label">
                        <input type="checkbox" id="autoQuality" checked>
                        <span>Auto-select best quality</span>
                    </label>
                    <p class="help-text">Automatically adjusts quality based on your connection</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Subtitle Selection Modal -->
    <div class="modal" id="subtitleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Subtitles</h3>
                <button class="modal-close" id="closeSubtitleModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="subtitle-options" id="subtitleOptions">
                    <div class="subtitle-option active" data-lang="off">
                        <span class="subtitle-name">Off</span>
                    </div>
                    <!-- Subtitles loaded by JS -->
                </div>
                <div class="subtitle-settings">
                    <h4>Settings</h4>
                    <div class="setting-item">
                        <label>Size</label>
                        <select id="subtitleSize">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Color</label>
                        <select id="subtitleColor">
                            <option value="white" selected>White</option>
                            <option value="yellow">Yellow</option>
                            <option value="green">Green</option>
                            <option value="cyan">Cyan</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Playback Speed Modal -->
    <div class="modal" id="speedModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Playback Speed</h3>
                <button class="modal-close" id="closeSpeedModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="speed-options" id="speedOptions">
                    <button class="speed-option" data-speed="0.25">0.25x</button>
                    <button class="speed-option" data-speed="0.5">0.5x</button>
                    <button class="speed-option" data-speed="0.75">0.75x</button>
                    <button class="speed-option active" data-speed="1">Normal</button>
                    <button class="speed-option" data-speed="1.25">1.25x</button>
                    <button class="speed-option" data-speed="1.5">1.5x</button>
                    <button class="speed-option" data-speed="1.75">1.75x</button>
                    <button class="speed-option" data-speed="2">2x</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <script src="scripts/utils.js"></script>
    <script src="scripts/api.js"></script>
    <script src="scripts/playback.js"></script>
    
    <script>
        // Initialize theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.classList.toggle('dark-theme', savedTheme === 'dark');
    </script>
</body>
</html>
